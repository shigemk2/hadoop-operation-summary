# トラブルシューティング

レイヤー間でのやりとりが、Hadoopのようなシステムを複雑なものにし、そのトラブルシューティングを難しくしている

## 9-1 システムへの鑑別診断の適用

+ ホスト クラスタ ネットワークで最近起きたことの履歴をまとめる
+ 可能性のある診断のリストをまとめる
+ 可能性の順にリストをソートする
+ テスト
+ 診断する

## 9-2 一般的な障害と問題

- 人間
   - 一般的なシステム管理上の問題
- 設定のミス
    - たぶんこれ https://www.cloudera.com/resources.html
    - 見ておくべきもの
        - 設定のオーバーライドの優先度
        - 手を付けるのは運用に基本的なパラメータのみにする
        - 設定を行うときはやろうとしていることがなんなのかしっかり理解すること
        - パラメータはダブルチェックすること
        - 設定ファイルは頻繁に監査すること
        - デプロイシステムを利用してすべてのファイルがすべてのホストで最新になっていること
        - 適切にデーモンが再起動されていること
        - 設定変更の前後でMapReduceジョブの一部を実行してその変更がパフォーマンスとリソース消費に与える影響を評価
- ハードウエアの障害
- リソースの不足
    - デーモンの障害
    - タスクがJVMヒープサイズの上限に達する
    - 障害の計測と追跡
- ホストの識別と命名
    - 結構多いトラブル(HadoopMLの質問もこれでぜんぶ片がつく)
- ネットワークの分断
    - メッセージングプロセスのガベージコレクションがネットワーク障害と誤認される可能性

## 9-3 電源ケーブルはつながっているか
### E-SPORE

- 環境 environment
- スタック stack
- パターン pattern
- 出力 output
- リソース resources
- イベントの相関 event correlation

## 9-4 処置とケア

- 根絶治療
- 設定による緩和治療
- アーキテクチャによる緩和治療
- プロセスによる緩和治療

- 再起動してみよう症候群

- 問題を検出し、対応し、修正すること vs 障害から学びを得る
     - 障害から学びを得るのも必要
- 予防的メンテナンスは緊急のメンテナンスよりも安上がり
- **ポストモーテム**
